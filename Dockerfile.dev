FROM golang:1.25-alpine

WORKDIR /app/src

# Install dev deps (including build tools for CGO/SQLite)
RUN apk add --no-cache git ca-certificates tzdata busybox-extras build-base

# Install air for hot reload
RUN go install github.com/air-verse/air@latest

# Copy go mod files
COPY go.mod go.sum ./
RUN go mod download

# Create directories
RUN mkdir -p /app/whatsapp_session /app/bin

# Copy air config
COPY .air.toml /app/.air.toml

# Copy entrypoint
COPY .docker/entrypoint-dev.sh /app/entrypoint.sh
RUN chmod +x /app/entrypoint.sh

EXPOSE 8080

ENTRYPOINT ["/app/entrypoint.sh"]
